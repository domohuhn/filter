

<!doctype html>
<html>
<style>
body {
  color: #222;
  background: #fff;
  font: 100% system-ui;
  --main-grid-color: rgb(216, 217, 220);
}
a {
  color: #0033cc;
}
.title {
  color: #809fff;
  text-align: center;
  margin-top: 20px;
  margin-bottom: 20px;
}
.main-center {
  margin-left: auto;
  margin-right: auto;
  width: 60%;
}

.footer {
  text-align: center;
  font-size: smaller;
}

img.icon {
  margin-right: 8px;
}
input[type="number"][disabled] {
  background: #b7b7b7;
  border-color: #b7b7b7;
  border-style: solid;
}

.toggleButton {
  border-radius: 4px;
  border-style: solid;
  background-color: #809fff;
  border-color: #809fff;
  color: #000;
}

.toggleButton:hover {
  background-color: #c7d5ff;
  border-color: #c7d5ff;
}

.toggleButton:active {
  background-color: #6588f0;
  border-color: #6588f0;
}

table.chart {
  margin-top: 32px;
  margin-bottom: 32px;
}

.tab {
  margin: auto;
  width: 60%;
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
}

.tab button:hover {
  background-color: #ddd;
}

.tab button.active {
  background-color: #ccc;
}

.tabcontent {
  margin: auto;
  width: 60%;
  display: none;
  padding: 6px 0px;
  border: 1px solid #ccc;
  border-top: none;
  animation: fadeEffect 1s;
  background-color: #f9f9f9;
}

@keyframes fadeEffect {
  from {opacity: 0;}
  to {opacity: 1;}
}

span.comment {
  color:rgb(32, 123, 39);
}
span.type {
  color:rgb(33, 36, 224);
}
span.enum {
  color:rgb(35, 100, 241);
}
span.preprocessor {
  color:rgb(209, 16, 209);
}
span.keyword {
  color:rgb(209, 16, 209);
}
span.number {
  color:rgb(46, 108, 60);
}
span.string {
  color:rgb(185, 58, 58);
}

@media (prefers-color-scheme: dark) {
  body {
    color: #c9d1d9;
    background: #21262d;
    --main-grid-color: rgb(90, 90, 97);
  }

  body a {
    color: #809fff;
  }
  input[type="number"][disabled] {
  background: #9e9e9e;
  border-color: #9e9e9e;
  border-style: solid;
  }
  .tab {
  border: 1px solid rgb(90, 90, 97);
  background-color: #707070;
  }
  .tab button {
    color: #c9d1d9;
}
  
.tab button:hover {
  color: #222;
  background-color: #aaa;
}

.tab button.active {
  color: #222;
  background-color: #aaa;
}

.tabcontent {
  border: 1px solid #707070;
  background-color: #1c1e20;
}
span.comment {
  color:rgb(54, 185, 65);
}
span.type {  
  color: rgb(137, 139, 255);
}
span.enum {
  color:rgb(136, 173, 255);
}
span.number {
  color:rgb(186, 240, 198);
}
}
</style>

  <head>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
</head>
<body>
<div class="main-center">
<h1 class="title"><img class="icon" src="favicon-32x32.png" width="25" height="25"></img>Design your digital filter!</h1>
<p>Design a filter according to your needs by selecting the values below. Scroll to the bottom of the page to get code snippets in your favourite programming language that generates a filter with the same characteristic! The source code for the generator and a library for C/C++/Javascript can found on <a href="https://github.com/domohuhn/filter">Github.</a></p>
</div>

<div class="main-center">
  <table cellspacing="0" border="0">
  <tr>
  <td class="InputLabel" width="25%">Filter type:</td>
  <td class="InputBox" width="25%">
  <select id="filterType">
    <option value="BwLP">Butterworth low pass (IIR)</option>
    <option value="BwHP">Butterworth high pass (IIR)</option>
    <option value="BwBP">Butterworth band pass (IIR)</option>
    <option value="BwBS">Butterworth band stop (IIR)</option>
    <option value="ChLP">Chebyshev type 1 low pass (IIR)</option>
    <option value="ChHP">Chebyshev type 1 high pass (IIR)</option>
    <option value="ChBP">Chebyshev type 1 band pass (IIR)</option>
    <option value="ChBS">Chebyshev type 1 band stop (IIR)</option>
    <option value="ChLP2">Chebyshev type 2 low pass (IIR)</option>
    <option value="ChHP2">Chebyshev type 2 high pass (IIR)</option>
    <option value="ChBP2">Chebyshev type 2 band pass (IIR)</option>
    <option value="ChBS2">Chebyshev type 2 band stop (IIR)</option>
    <option value="WsLP">Brickwall low pass (FIR)</option>
    <option value="WsHP">Brickwall high pass (FIR)</option>
    <option value="WsBP">Brickwall band pass (FIR)</option>
    <option value="WsBS">Brickwall band stop (FIR)</option>
    <option value="MaLP">Moving average low pass (FIR)</option>
    <option value="MaHP">Moving average high pass (FIR)</option>
    <option value="ExLP">Exponential low pass (IIR)</option>
    <option value="ExLP2">Exponential low pass (FIR)</option>
    <option value="noFi">No Filter (FIR)</option>
  </select></td>
  <td class="InputLabel" width="25%">Order:</td><td class="InputBox" width="25%"><input name="order" type="number" id="order" step="1" min="0" value="5"/></td></tr>
  <tr><td class="InputLabel" width="25%">Sampling Frequency (Hz):</td><td class="InputBox" width="25%"><input name="frequencies" type="number" id="frequency" step="0.001"  min="0" value="100"/></td>
    <td class="InputLabel" width="25%">Cutoff 2 (Hz):</td><td class="InputBox" width="25%"><input name="frequencies2" type="number" id="cutoff2" step="0.001"  min="0" value="35"/></td></tr>
  <tr><td class="InputLabel" width="25%">Cutoff 1 (Hz):</td><td class="InputBox" width="25%"><input name="frequencies" type="number" id="cutoff1" step="0.001"  min="0" value="15"/></td>
  <td class="InputLabel" width="25%">Ripple (dB):</td><td class="InputBox" width="25%"><input name="chebyshev" type="number" id="ripple" step="0.001" max="0" value="-3"/></td></tr>
  <tr><td class="InputLabel" width="25%">Share:</td><td width="25%"><button class="toggleButton" onclick="createLink()">Copy to link clipboard</button> </td> </tr>
</table>
</div>

<center>
<table class="chart" width="60%" cellspacing="0" border="0">
<tr><td class="chart"  width="50%">
<div>
  <canvas id="gainChart">Please enable javascript or use a newer browser!</canvas>
</div>
</td>
<td class="chart" width="50%">
<div>
  <canvas id="phaseChart">Please enable javascript or use a newer browser!</canvas>
</div></td>
</tr>
<tr><td class="chart"  width="50%">
  <div>
    <canvas id="stepChart">Please enable javascript or use a newer browser!</canvas>
  </div>
  </td>
  <td class="chart" width="50%">
  <div>
    <canvas id="impulseChart">Please enable javascript or use a newer browser!</canvas>
  </div></td>
  </tr>
</table>
</center>

<h2 class="main-center title">Code snippets</h2>

<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'recurrence')" id="defaultOpen">Recurrence relation</button>
  <button class="tablinks" onclick="openTab(event, 'c-lib')">C (with library)</button>
  <button class="tablinks" onclick="openTab(event, 'c++-lib')">C++ (with library)</button>
  <button class="tablinks" onclick="openTab(event, 'javascript-lib')">Javascript (with library)</button>
  <button class="tablinks" onclick="openTab(event, 'c')">C</button>
</div>


<div id="recurrence" class="tabcontent" style="display: block;">
  <pre>  Please enable javascript to see the generated code!</pre>
</div>
<div id="c-lib" class="tabcontent"></div>
<div id="c++-lib" class="tabcontent"></div>
<div id="javascript-lib" class="tabcontent"></div>
<div id="c" class="tabcontent"></div>

<div class="text-center">
  <p class="footer"><a href="https://github.com/domohuhn/filter">Filter library</a> by domohuhn.</p>
</div>
</body>
<script>
function openTab(evt, tab) {
  var i, tabcontent, tablinks;

  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }

  document.getElementById(tab).style.display = "block";
  evt.currentTarget.className += " active";
}
document.getElementById("defaultOpen").click();
</script>
<script>
function disableInputs(name,inactive) {
  var elems = document.getElementsByName(name);
  for(i = 0; i < elems.length; i++) {
	elems[i].disabled = inactive;
  }
}
disableInputs("chebyshev",true);



var filterSel = document.getElementById("filterType");
filterSel.addEventListener("change", function() {
	var type = filterSel.options[filterSel.selectedIndex].value;
	disableInputs("frequencies2",type.substring(2,4)!="BP" && type.substring(2,4)!="BS");
	switch(type) {
		case "BwLP": 
		case "BwHP": 
		case "BwBP": 
		case "BwBS":
		case "WsLP":
		case "WsHP":
		case "WsBP":
		case "WsBS":
			disableInputs("order",false);
			disableInputs("frequencies",false);
			disableInputs("chebyshev",true);
			console.log('switching to butterworth input mask');
			break;
		case "MaLP": 
		case "MaHP":
			console.log('switching to moving average input mask');
			disableInputs("order",false);
			disableInputs("frequencies",true);
			disableInputs("chebyshev",true);
			break;
		case "ExLP":
			console.log('switching to exp input mask');
			disableInputs("order",true);
			disableInputs("frequencies",false);
			disableInputs("chebyshev",true);
			break;
		case "ExLP2":
			console.log('switching to exp input mask');
			disableInputs("order",false);
			disableInputs("frequencies",false);
			disableInputs("chebyshev",true);
			break;
		default:
			console.log('switching to everything');
			disableInputs("order",false);
			disableInputs("frequencies",false);
			disableInputs("chebyshev",false);
	}
  updateGraphs();
});

function getSelectedFilter() {
  switch(filterSel.options[filterSel.selectedIndex].value){
    case "BwLP": return Module.FilterType.IIR_BUTTERWORTH_LOWPASS;
    case "BwHP": return Module.FilterType.IIR_BUTTERWORTH_HIGHPASS;
    case "BwBP": return Module.FilterType.IIR_BUTTERWORTH_BANDPASS;
    case "BwBS": return Module.FilterType.IIR_BUTTERWORTH_BANDSTOP;
    case "ChLP": return Module.FilterType.IIR_CHEBYSHEV_LOWPASS;
    case "ChHP": return Module.FilterType.IIR_CHEBYSHEV_HIGHPASS;
    case "ChBP": return Module.FilterType.IIR_CHEBYSHEV_BANDPASS;
    case "ChBS": return Module.FilterType.IIR_CHEBYSHEV_BANDSTOP;
    case "ChLP2": return Module.FilterType.IIR_CHEBYSHEV2_LOWPASS;
    case "ChHP2": return Module.FilterType.IIR_CHEBYSHEV2_HIGHPASS;
    case "ChBP2": return Module.FilterType.IIR_CHEBYSHEV2_BANDPASS;
    case "ChBS2": return Module.FilterType.IIR_CHEBYSHEV2_BANDSTOP;
    case "WsLP": return Module.FilterType.FIR_BRICKWALL_LOWPASS;
    case "WsHP": return Module.FilterType.FIR_BRICKWALL_HIGHPASS;
    case "WsBP": return Module.FilterType.FIR_BRICKWALL_BANDPASS;
    case "WsBS": return Module.FilterType.FIR_BRICKWALL_BANDSTOP;
    case "MaLP": return Module.FilterType.FIR_MOVING_AVERAGE_LOWPASS;
    case "MaHP": return Module.FilterType.FIR_MOVING_AVERAGE_HIGHPASS;
    case "ExLP": return Module.FilterType.IIR_EXPONENTIAL_LOWPASS;
    case "ExLP2": return Module.FilterType.FIR_EXPONENTIAL_MOVING_AVERAGE_LOWPASS;
    default: return Module.FilterType.NO_FILTER;
  }
}

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
if(urlParams.get('filter')!=null){
  let element = document.getElementById("filterType");
  element.value = urlParams.get('filter');
}
if(urlParams.get('order')!=null) {
  document.getElementById("order").value = urlParams.get('order');
}
if(urlParams.get('freq')!=null) {
  document.getElementById("frequency").value = urlParams.get('freq');
}
if(urlParams.get('cut1')!=null) {
  document.getElementById("cutoff1").value = urlParams.get('cut1');
}
if(urlParams.get('cut2')!=null) {
  document.getElementById("cutoff2").value = urlParams.get('cut2');
}
if(urlParams.get('ripple')!=null) {
  document.getElementById("ripple").value = urlParams.get('ripple');
}

</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="js/graphs.js"></script>
<script src="js/make_codesnippet.js"></script>
<script>
  function updateGraphs() {
    var pars = new Module.FilterParameters();
    pars.filterType = getSelectedFilter();
    pars.cutoffFrequencyLow = parseFloat(document.getElementById("cutoff1").value);
    pars.cutoffFrequencyHigh = parseFloat(document.getElementById("cutoff2").value);
    pars.samplingFrequency = parseFloat(document.getElementById("frequency").value);
    pars.ripple = parseFloat(document.getElementById("ripple").value);
    pars.filterOrder = parseFloat(document.getElementById("order").value);

    var startTime = performance.now();
    var filt = new Module.Filter(pars);

    var endTime = performance.now();
    var nfw = filt.countFeedforwardCoefficients;
    var nfb = filt.countFeedbackCoefficients;

    const chartConfig = {
      gain: {
        name: 'gain1',
        id: 'gainChart'
      },
      phase: {
        name: 'phase1',
        id: 'phaseChart'
      },
    };
    var resp = filt.frequencyResponse(200);
    plotPhaseAndGain(resp, chartConfig);
    
    const chartConfigStep = {
      name: 'step1',
      id: 'stepChart'
    };
    const chartConfigImpulse = {
      name: 'impulse1',
      id: 'impulseChart'
    };
    var respStep = filt.stepResponse();
    plotResponse(respStep, chartConfigStep);
    var respImpulse = filt.impulseResponse();
    plotResponse(respImpulse, chartConfigImpulse);
    document.getElementById("recurrence").innerHTML = generate_recurrence_relation(pars,filt);
    document.getElementById("c-lib").innerHTML = generate_c_lib(pars);
    document.getElementById("c++-lib").innerHTML = generate_cpp_lib(pars);
    document.getElementById("javascript-lib").innerHTML = generate_javascript_lib(pars);
    document.getElementById("c").innerHTML = generate_c(pars,filt);
  }

  var Module = {
    onRuntimeInitialized: function() {
      updateGraphs();
    }
  };
</script>
<script src="js/filter.js"></script>
<script>
  function addUpdateListener(name, inactive) {
    var elems = document.getElementsByName(name);
    for (i = 0; i < elems.length; i++) {
      elems[i].addEventListener("change", function () {
        updateGraphs();
      });
    }
  }
  addUpdateListener("order");
  addUpdateListener("frequencies");
  addUpdateListener("frequencies2");
  addUpdateListener("chebyshev");
</script>
<script>
  function createLink() {
    var url = window.location.href;
    if(url.includes('?')){
      var end = url.indexOf('?');
      url = url.substring(0,end);
    }
    url += '?filter=' + filterSel.options[filterSel.selectedIndex].value;
    url += '&order=' + document.getElementById("order").value;
    url += '&freq=' + document.getElementById("frequency").value;
    url += '&cut1=' + document.getElementById("cutoff1").value;
    url += '&cut2=' + document.getElementById("cutoff2").value;
    url += '&ripple=' + document.getElementById("ripple").value;
    navigator.clipboard.writeText(url);
  }
</script>
</html>



